{% macro photoswipe_dom_boilerplate() -%}
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

  <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg"></div>

  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">

    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>

    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">

      <div class="pswp__top-bar">

        <!--  Controls are self-explanatory. Order can be changed. -->

        <div class="pswp__counter"></div>

        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

        <button class="pswp__button pswp__button--share" title="Share"></button>

        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip"></div>
      </div>

      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>

      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>

      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>
<script>
(function(){
  var initPhotoSwipeFromDOM = function (gallerySelector) {

    // parse slide data (url, title, size ...) from DOM elements 
    // (children of gallerySelector)
    var parseThumbnailElements = function (el) {
      var thumbElements = el.childNodes,
        numNodes = thumbElements.length,
        items = [],
        figureEl,
        linkEl,
        size,
        item;

      for (var i = 0; i < numNodes; i++) {

        figureEl = thumbElements[i]; // <figure> element

        // include only element nodes 
        if (figureEl.nodeType !== 1) {
          continue;
        }

        linkEl = figureEl.children[0]; // <a> element

        size = linkEl.getAttribute('data-size').split('x');

        // create slide object
        item = {
          src: linkEl.getAttribute('href'),
          w: parseInt(size[0], 10),
          h: parseInt(size[1], 10)
        };



        if (figureEl.children.length > 1) {
          // <figcaption> content
          item.title = figureEl.children[1].innerHTML;
        }

        if (linkEl.children.length > 0) {
          // <img> thumbnail element, retrieving thumbnail url
          item.msrc = linkEl.children[0].getAttribute('src');
        }

        item.el = figureEl; // save link to element for getThumbBoundsFn
        items.push(item);
      }

      return items;
    };

    // find nearest parent element
    var closest = function closest(el, fn) {
      return el && (fn(el) ? el : closest(el.parentNode, fn));
    };

    // triggers when user clicks on thumbnail
    var onThumbnailsClick = function (e) {
      e = e || window.event;
      e.preventDefault ? e.preventDefault() : e.returnValue = false;

      var eTarget = e.target || e.srcElement;

      // find root element of slide
      var clickedListItem = closest(eTarget, function (el) {
        return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
      });

      if (!clickedListItem) {
        return;
      }

      // find index of clicked item by looping through all child nodes
      // alternatively, you may define index via data- attribute
      var clickedGallery = clickedListItem.parentNode,
        childNodes = clickedListItem.parentNode.childNodes,
        numChildNodes = childNodes.length,
        nodeIndex = 0,
        index;

      for (var i = 0; i < numChildNodes; i++) {
        if (childNodes[i].nodeType !== 1) {
          continue;
        }

        if (childNodes[i] === clickedListItem) {
          index = nodeIndex;
          break;
        }
        nodeIndex++;
      }

      if (index >= 0) {
        // open PhotoSwipe if valid index found
        openPhotoSwipe(index, clickedGallery);
      }
      return false;
    };

    // parse picture index and gallery index from URL (#&pid=1&gid=2)
    var photoswipeParseHash = function () {
      var hash = window.location.hash.substring(1),
        params = {};

      if (hash.length < 5) {
        return params;
      }

      var vars = hash.split('&');
      for (var i = 0; i < vars.length; i++) {
        if (!vars[i]) {
          continue;
        }
        var pair = vars[i].split('=');
        if (pair.length < 2) {
          continue;
        }
        params[pair[0]] = pair[1];
      }

      if (params.gid) {
        params.gid = parseInt(params.gid, 10);
      }

      return params;
    };

    var openPhotoSwipe = function (index, galleryElement, disableAnimation, fromURL) {
      var pswpElement = document.querySelectorAll('.pswp')[0],
        gallery,
        options,
        items;

      items = parseThumbnailElements(galleryElement);

      // define options (if needed)
      options = {
        bgOpacity: 0.8,
        captionEl: false,
        tapToClose: true,
        shareEl: false,
        fullscreenEl: false,


        // define gallery index (for URL)
        galleryUID: galleryElement.getAttribute('data-pswp-uid'),

        getThumbBoundsFn: function (index) {
          // See Options -> getThumbBoundsFn section of documentation for more info
          var thumbnail = items[index].el.getElementsByTagName('img')[0], // find thumbnail
            pageYScroll = window.pageYOffset || document.documentElement.scrollTop,
            rect = thumbnail.getBoundingClientRect();

          return { x: rect.left, y: rect.top + pageYScroll, w: rect.width };
        }

      };

      // PhotoSwipe opened from URL
      if (fromURL) {
        if (options.galleryPIDs) {
          // parse real index when custom PIDs are used 
          // http://photoswipe.com/documentation/faq.html#custom-pid-in-url
          for (var j = 0; j < items.length; j++) {
            if (items[j].pid == index) {
              options.index = j;
              break;
            }
          }
        } else {
          // in URL indexes start from 1
          options.index = parseInt(index, 10) - 1;
        }
      } else {
        options.index = parseInt(index, 10);
      }

      // exit if index not found
      if (isNaN(options.index)) {
        return;
      }

      if (disableAnimation) {
        options.showAnimationDuration = 0;
      }

      // Pass data to PhotoSwipe and initialize it
      gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
      gallery.init();
    };

    // loop through all gallery elements and bind events
    var galleryElements = document.querySelectorAll(gallerySelector);

    for (var i = 0, l = galleryElements.length; i < l; i++) {
      galleryElements[i].setAttribute('data-pswp-uid', i + 1);
      galleryElements[i].onclick = onThumbnailsClick;
    }

    // Parse URL and open gallery if it contains #&pid=3&gid=1
    var hashData = photoswipeParseHash();
    if (hashData.pid && hashData.gid) {
      openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);
    }
  };

  // execute above function
  initPhotoSwipeFromDOM("*[itemtype='http://schema.org/ImageGallery']");
})();
</script>
{%- endmacro %}

{% macro render_args(klass, args, examples={}) -%}
  <div class="method-list {{klass}}">
    <ul class="method-list-group">
      {% for name, kind, description in args | sort %}
      <li class="method-list-item {% if name in examples %}has-example{% endif %}">
        <h5 class="method-list-item-label">
          {{name}}
          <span class="method-list-item-label-details">{{kind.replace("<", "&lt;").replace(">", "&gt;")}}</span>
        </h5>
        <p class="method-list-item-description">{{description|join("\n")}}</p>
        {% if name in examples %}
<span class="method-list-item-example">{{html_repr(examples[name])}}</span>
      {% endif %}
      </li>
      {% endfor %}
    </ul>
  </div>
{%- endmacro %}

{% macro language_tabs() -%}
  <div class="tabs tabs-code">
    <nav class="nav-languages">
      {% for lang in languages %}
      <a data-language="{{lang['language']}}"{% if loop.first %} class="selected"{% endif %}>{{lang['label']}}</a>
      {% endfor %}
    </nav>
  </div>
{%- endmacro %}

<!doctype html>
<html>
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    {{extra_scripts}}
    <link rel="stylesheet" href="/design/fonts/whitney.css">
    <meta property="og:title" content="{{title}}" />
    <meta property="og:description" content="{{description}}" />
    {% if include_snapshot %}<meta name="tesserai:snapshot" content="{{proto}}://{{host}}/meta/snapshot"/>{% endif %}

    <!-- <meta property="og:image" content="http://example.com/foo.png" /> -->
    <!-- <meta property="og:site_name" content="Tesserai"/> -->
    <!-- <meta property="og:url" content="http://example.com/canonical-url" /> -->

    <link rel="stylesheet" href="static/primer-tooltip.css" />
    <link rel="stylesheet" href="static/prism_light.css" />
    <link rel="stylesheet" href="static/json-formatter.css" />
    <link rel="stylesheet" href="static/template.css" />
    <link rel="stylesheet" href="static/photoswipe/photoswipe.css">
    <link rel="stylesheet" href="static/photoswipe/default-skin/default-skin.css">
    <script src="static/clipboard.min.js"></script>
    <script src="static/prism.min.js"></script>
    <script src="static/json-formatter.js"></script>
    <script src="static/photoswipe/photoswipe.min.js"></script>
    <script src="static/photoswipe/photoswipe-ui-default.min.js"></script>
  </head>

  <body id="documentation" class="">
    <header>
      <nav class="topnav jump-menu" id="top-nav">
        <div class="nav-right">
          <ul class="list-inline">
            <li class="nav-brand">
              <a target="none" href="https://tesserai.com">Tesserai</a>
            </li>
            <li><select>
              {% for section in body_sections %}
              {% if section['title'] and section['id'] %}
              <option label="{{section['title']}}">{{section['id']}}</option>
              {% endif %}
              {% endfor %}
              <optgroup label="Methods">
                {% for method in methods %}
                <option label="{{method['name']}} method">method-{{method['name']}}</option>
                {% endfor %}
              </optgroup>
              {% for section in appendix_sections %}
              {% if section['title'] and section['id'] %}
              <option label="{{section['title']}}">{{section['id']}}</option>
              {% endif %}
              {% endfor %}
              {% if implementation_notes | length > 0 %}
              <option label="Implementation Notes">implementation-notes</option>
              {% endif %}
              {% if hyperparameters | length > 0 %}
              <option label="Hyperparameters">hyperparameters</option>
              {% endif %}
              {% if references | length > 0 %}
              <option label="References">references</option>
              {% endif %}
            </select></li>
          </ul>
        </div>
      </nav>

    </header>
    <div id="head">
      {% if source %}
      <div class="source-code-ref">
        <a href="{{source['url']}}">{{source['label']}}</a>
        <div class="commit">commit {{source['commit']}}</div>
      </div>
      {% endif %}
        <h1>{{title}}</h1>
        <p>{{subhead}}</p>
    </div>

    {% for section in body_sections %}
      {{section['body']}}
    {% endfor %}

    <section>
      <h2>Getting Started</h2>
      <p>
        You can use this API without installing any software. You can also run this API locally without internet access.
        Local access to the API is possible from both the command line and from within Python.
        Use the command below to get setup and confirm the API is working for you.
      </p>

      <div class="method-example">
        {% for lang in languages %}
        <div class="method-example-code" data-language="{{lang['language']}}"{% if not loop.first %} style="display: none;"{% endif %}>
          <pre><code class="{{lang['getting_started_class']}} line-numbers">{{lang['getting_started']}}</code></pre>
        </div>
        {% endfor %}
        {{language_tabs()}}
      </div>
    </section>

    <section>
      <h2>Method Documentation</h2>
      <p>
        The methods below all have examples that work as-is. Copy and run them in your terminal to start experimenting.
      </p>
    </section>

    {% for method in methods %}
    <section class="method" id="method-{{method['name']}}">
      <div class="method-copy">
        <h3>{{method['name']}} method</h3>
        {{method['overview']}}
      </div>
      {% if method['args'] | length > 0 %}
      <div class="method-copy">
          {{render_args('inputs', method['args'], method['example args'])}}
      </div>
      {% endif %}
      <div class="method-example">
        {% for lang in languages %}
        <div class="method-example-code" data-language="{{lang['language']}}"{% if not loop.first %} style="display: none;"{% endif %}>
          <pre><code class="{{lang['example_for_class']}} line-numbers">{{lang['example_for'](method)}}</code></pre>
        </div>
        {% endfor %}
        {{language_tabs()}}
      </div>
      <div class="method-copy">
        {% if method['returns'] | length > 0 %}
          {{render_args('outputs', method['returns'])}}
        {% endif %}
      </div>
      <div class="method-example">
        {% for lang in languages %}
        <div class="method-example-code" data-language="{{lang['language']}}"{% if not loop.first %} style="display: none;"{% endif %}>
          <pre><code class="{{lang['repr_class']}}">{{lang['repr'](method['example result'], 50, 7)}}</code></pre>
        </div>
        {% endfor %}
      </div>
    </section>
    {% endfor %}

    {% if references | length > 0 or hyperparameters | length > 0 or implementation_notes | length > 0 or appendix_sections | length > 0 %}

    <div id="appendix">
    {% for section in appendix_sections %}
      {{section['body']}}
    {% endfor %}

    {% if implementation_notes | length > 0 %}
    <section class="implementation-notes" id="implementation-notes">
      <h3>Implementation Notes</h3>
      <div class="method-copy">
        {% for ps in implementation_notes %} {% for p in ps %}
        <p>{{p}}</p>
        {% endfor %} {% endfor %}
      </div>
    </section>
    {% endif %}
    {% if authors | length > 0 %}
    <section id="authorship">
      <h2>Contributors</h2>
      {% for author in authors %}
      <span class="author">
        <span class="author-name">
          <a href="{{author['url']}}"><strong>{{author['name']}}</strong></a> <a href="{{author['role_url']}}">[{{author['role_noun']}}]</a>
        </span>
        <!-- TODO(adamb) Support multiple affiliations -->
      </span>
      {% endfor %}
    </section>
    {% endif %}

    {% if hyperparameters | length > 0 %}
    <section class="hyperparameters" id="hyperparameters">
      <h2>Hyperparameters</h2>
      <div class="method-copy">
        {{render_args('hyperparameters', hyperparameters)}}
      </div>
    </section>
    {% endif %}
    
    {% if references | length > 0 %}
    <section class="references" id="references">
      <h2>References</h2>
      <div class="method-copy">
        <ol>
          {% for bibtex_entry in references.values() %}
            <li>{{bibliography_cite(bibtex_entry)}}</li>
          {% endfor %}
        </ol>
      </div>
    </section>
    {% endif %}
    <div class="back-to-top">
      <a href="#"><p>Back to top</p></a>
    </div>
    {% endif %}
    {{ photoswipe_dom_boilerplate() }}
    <script src="static/waypoints.noframework.min.js"></script>

    <!-- responsive nav dropdown -->
    <script>
      function responsiveNav() {
          var x = document.getElementById("top-nav");
          if (x.className === "topnav") {
              x.className += " responsive";
          } else {
              x.className = "topnav";
          }
      }
    </script>

    <!-- scrolling dropdown -->
    <script>
      (function() {
        'use strict'
        var jumpMenuSelect = document.querySelector(".jump-menu select");
        jumpMenuSelect.addEventListener('change', function() {
          if (window.location.hash !== this.value) {
            window.location.hash = this.value;
          }
        });

        var selectedIndexByNavLink = {};
        var jumpMenuOptions = jumpMenuSelect.options;
        for (var i = 0; i < jumpMenuOptions.length; ++i) {
          var jumpMenuOption = jumpMenuOptions[i];
          selectedIndexByNavLink["#" + jumpMenuOption.value] = i;
        }

        console.log("selectedIndexByNavLink", selectedIndexByNavLink)
        var updateNavSelection = function() {
          var hash = window.location.hash;
          var selectedIndex = selectedIndexByNavLink[hash];
          if (selectedIndex === undefined) {
            console.log("no nav link for", hash);
            return;
          }
          if (jumpMenuSelect.selectedIndex === selectedIndex) {
            return;
          }

          jumpMenuSelect.selectedIndex = selectedIndex;
        };
        var createWaypointsForElements = function(elts) {
          for (var i = 0; i < elts.length; ++i) {
            var elt = elts[i];
            if (!elt.id) {
              console.log("not creating waypoint for", elt)
              continue;
            }

            console.log("creating waypoint for", elt)
            new Waypoint({
              element: elt,
              enabled: false,
              handler: function(direction) {
                var id = this.element.id;
                var windowLocationHash = window.location.hash;
                if (windowLocationHash.length === id.length + 1 &&
                    windowLocationHash.endsWith(id)) {
                  return;
                }
                window.history.replaceState({}, "", "#" + id);
                updateNavSelection();
              },
              offset: 0
            });
          }
        };

        createWaypointsForElements(document.querySelectorAll('section'));
        window.addEventListener('hashchange', function() {
          console.log("hashchange", window.location.hash);
          Waypoint.disableAll();
          updateNavSelection();
          setTimeout(function() { Waypoint.enableAll(); }, 100);
        });
        setTimeout(function() { console.log("enabling..."); Waypoint.enableAll(); }, 1000);

        document.addEventListener('DOMContentLoaded', function() {
          var hash = window.location.hash;
          if (hash !== undefined && hash !== "") {
            var elt = document.querySelector(hash);
            console.log("scrolling to", elt);
            Waypoint.disableAll();
            elt && elt.scrollIntoViewIfNeeded();
            updateNavSelection();
            setTimeout(function() { Waypoint.enableAll(); }, 100);
          }
        });
      })();
    </script>
    <script>
    (function() {
      "use strict";

      // Cache NodeLists since these won't change during page lifetime.
      var codeExamples = document.querySelectorAll('.method-example-code[data-language]');
      var languageChoiceSel = ".nav-languages a[data-language]";
      var selectedClass = "selected";
      var selectedLanguageChoiceSel = languageChoiceSel + "." + selectedClass;
      var languageChoices = document.querySelectorAll(languageChoiceSel);

      var chooseThisLanguage = function() {
        var lang = this.dataset["language"];

        codeExamples.forEach(function (elt) {
          elt.style.display = elt.dataset["language"] === lang ? 'block' : 'none';
        });

        languageChoices.forEach(function(e) {
          if (e.dataset["language"] === lang) {
            e.classList.add(selectedClass);
          } else {
            e.classList.remove(selectedClass);
          }
        });
      };


      var firstSelected;
      languageChoices.forEach(function(e) {
        e.addEventListener("click", chooseThisLanguage);
        if (!firstSelected && e.classList.contains(selectedClass)) {
          firstSelected = e;
        }
      });
      if (firstSelected) {
        chooseThisLanguage.bind(firstSelected)();
      }

    })();
    (function() {
      function clearTooltip(e) {
        e.currentTarget.setAttribute('class', 'clipboard-copy');
        e.currentTarget.removeAttribute('aria-label');
      }
      function showTooltip(elem, msg) {
        elem.setAttribute('class', 'clipboard-copy tooltipped tooltipped-s');
        elem.setAttribute('aria-label', msg);
      }
      function fallbackMessage(action) {
        var actionMsg = '';
        var actionKey = (action === 'cut' ? 'X' : 'C');
        if (/iPhone|iPad/i.test(navigator.userAgent)) {
          actionMsg = 'No support :(';
        } else if (/Mac/i.test(navigator.userAgent)) {
          actionMsg = 'Press ⌘-' + actionKey + ' to ' + action;
        } else {
          actionMsg = 'Press Ctrl-' + actionKey + ' to ' + action;
        }
        return actionMsg;
      }

      window.addCopyToClipboard = function (parent, text) {
        parent.style.position = 'relative';

        var btn = document.createElement("div");
        btn.className = "clipboard-copy";
        btn.innerHTML = '<div class="clipboard-copy-icon"></div>';

        parent.appendChild(btn);

        var cb = new Clipboard(btn, {
          text: function (trigger) {
            return text;
          }
        });
        cb.on('success', function (e) {
          e.clearSelection();
          showTooltip(e.trigger, 'Copied!');
        });
        cb.on('error', function (e) {
          showTooltip(e.trigger, fallbackMessage(e.action));
        });

        btn.addEventListener('mouseleave', clearTooltip);
        btn.addEventListener('blur', clearTooltip);
      }
    })();
    </script>
    <script>
      Prism.languages.curl = {
        "request-param": {
          pattern: /(?:-F )([a-zA-Z0-9]+)/g,
          inside: {
            "request-flag": /(^-F)/g
          }
        },
        "request-value": {
          pattern: /(?:=)(.*?)(?:\n|\\|$)/g,
          inside: {
            operator: /(^=)|(\\$)/g
          },
          alias: 'string',
          greedy: true
        },
        "request-url": {
          pattern: /(?:^curl )(.*?)(?:\n|\\)/g,
          inside: {
            operator: /(\\$)/g,
            keyword: /(^curl)/g
          },
          alias: 'string'
        }
      };
      Prism.hooks.add('complete', function (env) {
        addCopyToClipboard(env.element.parentNode.parentNode, env.code);
      })
    </script>
    <script>
      setTimeout(function() {
        document.querySelectorAll(".language-json2").forEach(function (e) {
          var text = e.innerText;
          var newParent = e.parentNode;
          e.remove();
          var val = JSON.parse(text);
          var elt = jsonObjToHTML(val, 10);
          addCopyToClipboard(newParent, text);
          newParent.appendChild(elt);
        });
      }, 0);
    </script>
    <script src="static/dthoverbox.js"></script>
  </body>
</html>
